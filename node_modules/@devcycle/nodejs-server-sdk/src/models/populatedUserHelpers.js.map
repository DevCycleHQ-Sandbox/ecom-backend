{"version":3,"file":"populatedUserHelpers.js","sourceRoot":"","sources":["../../../../../../../sdk/nodejs/src/models/populatedUserHelpers.ts"],"names":[],"mappings":"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","sourcesContent":["import { ProtobufTypes } from '@devcycle/bucketing-assembly-script'\nimport {\n    DVCPopulatedUser,\n    DevCycleUser,\n    DVCCustomDataJSON,\n    DevCyclePlatformDetails,\n} from '@devcycle/js-cloud-server-sdk'\nimport { getNodeJSPlatformDetails } from '../utils/platformDetails'\n\nexport function DVCPopulatedUserToPBUser(\n    user: DevCycleUser,\n): ProtobufTypes.DVCUser_PB {\n    const params = {\n        user_id: user.user_id,\n        email: ProtobufTypes.NullableString.create({\n            value: user.email || '',\n            isNull: !user.email,\n        }),\n        name: ProtobufTypes.NullableString.create({\n            value: user.name || '',\n            isNull: !user.name,\n        }),\n        language: ProtobufTypes.NullableString.create({\n            value: user.language || '',\n            isNull: !user.language,\n        }),\n        country: ProtobufTypes.NullableString.create({\n            value: user.country || '',\n            isNull: !user.country,\n        }),\n        appBuild: ProtobufTypes.NullableDouble.create({\n            value: user.appBuild || 0,\n            isNull: user.appBuild === null || user.appBuild === undefined,\n        }),\n        appVersion: ProtobufTypes.NullableString.create({\n            value: user.appVersion || '',\n            isNull: !user.appVersion,\n        }),\n        deviceModel: ProtobufTypes.NullableString.create({\n            value: '',\n            isNull: true,\n        }),\n        customData: getNullableCustomDataValue(user.customData),\n        privateCustomData: getNullableCustomDataValue(user.privateCustomData),\n    }\n    const err = ProtobufTypes.DVCUser_PB.verify(params)\n    if (err) throw new Error(`DVCUser protobuf verification error: ${err}`)\n\n    return ProtobufTypes.DVCUser_PB.create(params)\n}\n\nexport function DVCPopulatedUserFromDevCycleUser(\n    user: DevCycleUser,\n    platformDetails?: DevCyclePlatformDetails,\n): DVCPopulatedUser {\n    return new DVCPopulatedUser(\n        user,\n        platformDetails || getNodeJSPlatformDetails(),\n    )\n}\n\nexport function getNullableCustomDataValue(\n    customData?: DVCCustomDataJSON,\n): ProtobufTypes.NullableCustomData {\n    if (!customData) {\n        return ProtobufTypes.NullableCustomData.create({\n            value: {},\n            isNull: true,\n        })\n    }\n\n    const valuesMap: Record<string, ProtobufTypes.CustomDataValue> = {}\n    for (const key in customData) {\n        const value = customData[key]\n        if (typeof value === 'boolean') {\n            valuesMap[key] = ProtobufTypes.CustomDataValue.create({\n                type: ProtobufTypes.CustomDataType.Bool,\n                boolValue: value,\n            })\n        } else if (typeof value === 'number') {\n            valuesMap[key] = ProtobufTypes.CustomDataValue.create({\n                type: ProtobufTypes.CustomDataType.Num,\n                doubleValue: value,\n            })\n        } else if (typeof value === 'string') {\n            valuesMap[key] = ProtobufTypes.CustomDataValue.create({\n                type: ProtobufTypes.CustomDataType.Str,\n                stringValue: value,\n            })\n        } else if (value === null || value === undefined) {\n            valuesMap[key] = ProtobufTypes.CustomDataValue.create({\n                type: ProtobufTypes.CustomDataType.Null,\n            })\n        } else {\n            throw new Error(\n                `Unknown custom data type for ProtobufTypes.NullableCustomData: ${typeof value}`,\n            )\n        }\n    }\n    return ProtobufTypes.NullableCustomData.create({\n        value: valuesMap,\n        isNull: false,\n    })\n}\n"]}